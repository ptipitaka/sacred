---
/**
 * Division Component for Tipitaka sections
 * Represents a division/section with a number (e.g., (24.), (25.))
 */

export interface Props {
  number: string;
  book?: string; // Optional book identifier for PageFind metadata
  bookNo?: string; // Optional book number for filtering
  page?: string | number; // Optional page reference from DB
}

const {
  number,
  book = '',
  bookNo = '',
  page = ''
} = Astro.props;

// Generate PageFind metadata
const metadataValue = book ? `div:${book}-${number}` : `div:${number}`;
const pageMetadata = page ? `page:${page}` : undefined;
const bookNoMetadata = bookNo ? `bookNo:${bookNo}` : undefined;
const tooltipParts = [];

if (bookNo) {
  tooltipParts.push(`Volume ${bookNo}`);
}

if (page !== '' && page !== undefined && page !== null) {
  tooltipParts.push(`Page ${page}`);
}

const tooltip = tooltipParts.length ? tooltipParts.join(' · ') : undefined;
---

<div 
  data-pagefind-meta={metadataValue} 
  data-pagefind-meta-page={pageMetadata}
  data-pagefind-meta-bookno={bookNoMetadata}
  class="division-section"
  data-division={number}
  data-book={book || undefined}
  data-page={page || undefined}
  title={tooltip}
>
  <span class="division-number">{number}.</span>
  <div class="division-content">
    <slot />
  </div>
</div>

<style>
  .division-section {
    margin: 1.5rem 0;
    padding: 0;
    position: relative;
  }

  .division-number {
    font-weight: bold;
    color: var(--sl-color-text-accent, #007acc);
    font-size: 1em;
    padding: 0;
    line-height: 1.8;
    margin: 0;
    position: absolute;
    left: 0;
    top: 0;
    z-index: 1;
  }

  .division-content {
    padding: 0;
    line-height: 1.8;
    margin-top: 0;
    position: relative;
    /* ไม่ใช้ flexbox layout เพื่อไม่ให้ส่งผลต่อ paragraph positioning */
  }

  /* Dark mode support */
  :global([data-theme="dark"]) .division-number {
    color: var(--sl-color-white);
  }

  /* Responsive design */
  @media (max-width: 640px) {
    .division-section {
      margin: 1rem 0;
    }
    
    .division-number {
      font-size: 1em;
      padding: 0; /* ลบ padding ใน responsive */
    }
  }

  /* Print styles */
  @media print {
    .division-section {
      break-inside: avoid;
      margin: 1rem 0;
    }
    
    .division-number {
      color: #000;
    }
  }
</style>