---
import StarlightPage from '@astrojs/starlight/components/StarlightPage.astro'

interface EditionInfo {
  code: string;
  name: string;
  description: string;
  volumeCount: number;
}

// Scan for available editions
const editions: EditionInfo[] = [];

try {
  const fs = await import('fs');
  const path = await import('path');
  const tipitakaPath = path.join(process.cwd(), 'public', 'tipitaka');
  
  if (fs.existsSync(tipitakaPath)) {
    const editionDirs = fs.readdirSync(tipitakaPath, { withFileTypes: true });
    
    const editionNames: Record<string, string> = {
      'ch': 'ฉัฏฐสังคายนา',
      'mc': 'มหาชน',
      'sy': 'สยาม'
    };
    
    for (const editionDir of editionDirs) {
      if (editionDir.isDirectory() && editionNames[editionDir.name]) {
        const editionPath = path.join(tipitakaPath, editionDir.name);
        
        // Count volumes
        let volumeCount = 0;
        try {
          const volumes = fs.readdirSync(editionPath, { withFileTypes: true });
          volumeCount = volumes.filter(v => v.isDirectory()).length;
        } catch (error) {
          console.warn(`Cannot read volumes for edition ${editionDir.name}:`, error);
        }
        
        editions.push({
          code: editionDir.name,
          name: editionNames[editionDir.name],
          description: `พระไตรปิฎก ฉบับ${editionNames[editionDir.name]}`,
          volumeCount
        });
      }
    }
  }
} catch (error) {
  console.error('Error scanning editions:', error);
}
---

<StarlightPage
  frontmatter={{
    title: 'พระไตรปิฎก',
    description: 'เลือกชุดพระไตรปิฎกที่ต้องการศึกษา'
  }}
>
  <div class="editions-grid">
    {editions.map((edition) => (
      <div class="edition-card">
        <h3>
          <a href={`/tipitaka/${edition.code}`}>
            {edition.name}
          </a>
        </h3>
        <p class="edition-description">{edition.description}</p>
        <p class="volume-count">{edition.volumeCount} เล่ม</p>
      </div>
    ))}
  </div>

  {editions.length === 0 && (
    <div class="no-editions">
      <p>ไม่พบข้อมูลพระไตรปิฎก</p>
    </div>
  )}
</StarlightPage>

<style>
  .editions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
  }

  .edition-card {
    border: 1px solid var(--sl-color-gray-5);
    border-radius: 8px;
    padding: 1.5rem;
    text-align: center;
    transition: box-shadow 0.2s ease;
  }

  .edition-card:hover {
    box-shadow: 0 4px 12px var(--sl-color-gray-2);
  }

  .edition-card h3 {
    margin-top: 0;
    margin-bottom: 0.5rem;
  }

  .edition-card h3 a {
    text-decoration: none;
    color: var(--sl-color-text);
  }

  .edition-card h3 a:hover {
    color: var(--sl-color-accent);
  }

  .edition-description {
    color: var(--sl-color-text-accent);
    margin-bottom: 1rem;
  }

  .volume-count {
    font-weight: 600;
    color: var(--sl-color-accent);
    margin: 0;
  }

  .no-editions {
    text-align: center;
    padding: 2rem;
    color: var(--sl-color-text-accent);
  }
</style>
